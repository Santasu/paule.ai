<!DOCTYPE html>
<html lang="lt" data-theme="light" data-backend="vercel">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover"/>
  <title>Paule ‚Äì Premium AI Chat</title>

  <!-- Favicons -->
  <link rel="icon" href="/assets/icon/favicon.ico" sizes="any">
  <link rel="icon" type="image/png" href="/assets/icon/favicon-32.png" sizes="32x32">
  <link rel="icon" type="image/png" href="/assets/icon/favicon-192.png" sizes="192x192">
  <link rel="apple-touch-icon" href="/assets/icon/apple-touch-icon.png">
  <meta name="theme-color" content="#111827"/>

  <!-- Anti-cache -->
  <meta http-equiv="Cache-Control" content="no-store, max-age=0, must-revalidate">
  <meta http-equiv="Pragma" content="no-cache">
  <meta http-equiv="Expires" content="0">

  <!-- Host + Clerk + Stripe -->
  <link rel="preconnect" href="/" crossorigin>
  <link rel="preconnect" href="https://cdn.jsdelivr.net" crossorigin>
  <link rel="preconnect" href="https://js.stripe.com" crossorigin>
  <script async src="https://js.stripe.com/v3/pricing-table.js"></script>

  <!-- ‚ö°Ô∏è Clerk greitinimas -->
  <link rel="preconnect" href="https://clerk.com" crossorigin>
  <link rel="preconnect" href="https://api.clerk.com" crossorigin>
  <link rel="preconnect" href="https://img.clerk.com" crossorigin>
  <link rel="preconnect" href="https://f.clerk.com" crossorigin>
  <link rel="preload" as="script"
        href="https://cdn.jsdelivr.net/npm/@clerk/clerk-js@latest/dist/clerk.browser.js">

  <!-- Pagrindinis CSS -->
  <link rel="stylesheet" href="/assets/css/paule.css?v=1.1.3"/>

  <!-- Minimal≈´s inline guard'ai ir pataisos -->
  <style>
    :root{
      --icon-xxs:13px;
      --pill-scale:0.7;
    }

    #chatArea{min-height:calc(100vh - 240px);overflow:auto}
    @supports(height:100dvh){#chatArea{min-height:calc(100dvh - 240px)}}

    .jump-latest{bottom:2cm!important}
    .jump-latest span{display:none}
    .jump-latest img{width:16px;height:16px}

    .models-in-topbar .ui-icon,
    .avatar img,
    .message .avatar img{width:var(--icon-xxs);height:var(--icon-xxs)}

    .models-in-topbar{display:flex;gap:8px;flex-wrap:wrap}
    .models-in-topbar .model-pill{
      transform:scale(var(--pill-scale));
      transform-origin:left center;
      white-space:nowrap;
    }

    #bottomSection .input-bar .input-container{
      width:calc(100% - 6cm);
      margin:0 3cm;
    }
    @media (max-width:900px){
      #bottomSection .input-bar .input-container{width:100%;margin:0}
    }

    #inputSuggestDeck, #followSuggestBar{display:none !important}
    #messageInput::placeholder{color:transparent}

    .modal-overlay{
      position:fixed; inset:0; display:none; place-items:center; z-index:9999;
      background:rgba(0,0,0,.66);
    }
    .modal-overlay.show{display:grid}
    .modal-window{position:relative; width:min(1100px, 92vw); max-height:92vh; overflow:auto;
      background:var(--bg-primary,#fff); color:var(--text,#111827);
      border-radius:16px; box-shadow:0 20px 60px rgba(0,0,0,.35);
    }
    .modal-window.modal--sheet{padding:20px 24px}
    .modal-window.modal--tool{
      width:100vw; height:100vh; max-height:100vh; border-radius:0; padding:0; background:#0b0b0b;
      color:#e5e7eb;
    }
    .modal-close{
      position:fixed; top:16px; right:16px; z-index:10000;
      width:36px; height:36px; border-radius:999px; display:grid; place-items:center;
      border:1px solid rgba(255,255,255,.25); background:rgba(0,0,0,.45); color:#fff; cursor:pointer;
      backdrop-filter:saturate(130%) blur(6px);
    }
    .modal--sheet .modal-close{position:absolute; background:var(--bg-primary,#fff); color:#111827; border:1px solid var(--border,#e5e7eb)}
    .modal-body{padding:0; height:100%; overflow:auto}
    .modal-sheet-inner{padding:8px 6px 28px}

    .side-section.collapsible .side-title{
      display:flex; align-items:center; justify-content:space-between; cursor:pointer;
    }
    .side-section.collapsible .side-title .car{transition:transform .2s ease}
    .side-section.collapsible.collapsed .specialist-grid{display:none}
    .side-section.collapsible.collapsed .side-title .car{transform:rotate(-90deg)}

    .welcome-grid{display:grid; grid-template-columns:repeat(3,minmax(0,1fr)); gap:18px}
    .welcome-card{display:block; border-radius:16px; overflow:hidden; position:relative}
    .welcome-card img{width:100%; display:block}
    .welcome-card b{position:absolute; left:12px; bottom:34px; color:#fff}
    .welcome-card span{position:absolute; left:12px; bottom:12px; color:#e5e7eb; font-size:12px}
    @media (max-width:900px){.welcome-grid{grid-template-columns:repeat(2,minmax(0,1fr))}}

    .dim{opacity:.65}
    .pricing-section{margin-top:8px}

    /* üîß Typing dots ‚Äì labai minimalistinis */
    .typing-dots{display:inline-flex;gap:4px;align-items:center;opacity:.7}
    .typing-dots i{display:inline-block;width:6px;height:6px;border-radius:50%;background:var(--fg-muted,#6b7280);animation:tdot 1s infinite}
    .typing-dots i:nth-child(2){animation-delay:.15s}
    .typing-dots i:nth-child(3){animation-delay:.3s}
    @keyframes tdot{0%{transform:translateY(0)}50%{transform:translateY(-2px)}100%{transform:translateY(0)}}
  </style>

  <!-- App konfig≈´racija -->
  <script>
    (function () {
      var MODE=(document.documentElement.getAttribute('data-backend')||'').trim().toLowerCase()==='vercel'?'vercel':'wp';
      var restBase=MODE==='vercel'?'/api':'/wp-json/paule/v1';
      var routes={
        base:restBase, stream:restBase+'/stream', models:restBase+'/models', diagnostics:restBase+'/diagnostics',
        comicCreate:restBase+'/comic/create', fluxCreate:restBase+'/flux/create',
        musicCreate:restBase+'/music/create', musicStatus:restBase+'/music/status',
        runwayImage:restBase+'/runway/image', runwayStatus:restBase+'/runway/status'
      };
      var CFG={mode:MODE,restBase:routes.base,restStream:routes.stream,restStreamSSE:routes.stream,sseDefault:1,
        pluginBase:'/assets',iconsBase:'/assets/icon',featuresBase:'/assets/features',routes:routes,version:'paule-1.1.3'};
      window.PAULE_CONFIG=CFG; window.AUGAM_CONFIG=CFG;
      try{Object.defineProperty(window,'API_BASE',{configurable:true,get:function(){return CFG.restBase;},set:function(_){}});}catch(e){}
      window.__SET_API_BASE__=function(v){};
    })();
  </script>

  <!-- Bridge WP -> /api -->
  <script>
    (function(){
      'use strict';
      try{
        var restBase=(window.PAULE_CONFIG&&window.PAULE_CONFIG.restBase)||'/api';
        if(window.EventSource){
          var OrigES=window.EventSource;
          window.EventSource=function(url,opts){
            try{url=String(url).replace(/\/wp-json\/(?:augam|paule)\/v1(\/|$)/,'/api$1').replace(/\/(?:augam|paule)\/v1(\/|$)/,'/api$1');}catch(_){}
            return new OrigES(url,opts);
          };
          window.EventSource.prototype=OrigES.prototype;
        }
        if(window.fetch){
          var origFetch=window.fetch;
          window.fetch=function(input,init){
            try{
              var u=(typeof input==='string')?input:(input&&input.url);
              if(u){
                var nu=String(u).replace(/\/wp-json\/(?:augam|paule)\/v1(\/|$)/,'/api$1').replace(/\/(?:augam|paule)\/v1(\/|$)/,'/api$1');
                if(nu!==u) input=(typeof input==='string')?nu:new Request(nu,input);
              }
            }catch(_){}
            return origFetch(input,init);
          };
        }
        window.__FORCE_STREAM_ENDPOINT__=restBase.replace(/\/+$/,'')+'/stream';
      }catch(e){console.warn('[PAULE bridge] warning:',e);}
    })();
  </script>

  <!-- HOTFIX: SSE -> JSON kai mode=once -->
  <script>
    (function(){
      'use strict';
      if (!window.fetch) return;
      const prevFetch = window.fetch;

      async function toJsonFromSSE(resp, models){
        const reader  = resp.body?.getReader?.();
        if (!reader) return null;
        const dec = new TextDecoder();
        let buf = '', text = '';
        for(;;){
          const it = await reader.read();
          if (it.done) break;
          buf += dec.decode(it.value, {stream:true});
          let idx;
          while ((idx = buf.indexOf('\n\n')) >= 0){
            const frame = buf.slice(0, idx).trim(); buf = buf.slice(idx+2);
            if (!frame) continue;
            const dataLine = frame.split('\n').find(l => l.startsWith('data:'));
            if (!dataLine) continue;
            const payload = dataLine.replace(/^data:\s*/,'').trim();
            if (payload === '[DONE]') { buf=''; break; }
            try{
              const j = JSON.parse(payload);
              const piece = j?.choices?.[0]?.delta?.content ?? j?.text ?? '';
              if (typeof piece === 'string') text += piece;
            }catch(_){}
          }
        }
        const answers = (models && models.length ? models : ['auto']).map(m => ({ model:m, text }));
        return { ok:true, answers };
      }

      window.fetch = async function(input, init){
        const url  = typeof input==='string' ? input : (input && input.url) || '';
        const meth = (init && init.method) || (typeof input!=='string' && input && input.method) || 'GET';
        const isStreamOnce = /\/api\/stream(?:\?|$)/.test(url) && /mode=once/.test(url) && String(meth).toUpperCase()==='POST';
        if (!isStreamOnce) return prevFetch(input, init);

        let models = [];
        try {
          const raw = (init && init.body) ? String(init.body) : '';
          if (raw) {
            const b = JSON.parse(raw);
            if (typeof b.models === 'string') { models = b.models.split(',').map(s=>s.trim()).filter(Boolean); }
          }
        } catch(_){}

        const resp = await prevFetch(input, init);
        const ct   = (resp.headers.get('content-type')||'').toLowerCase();
        if (ct.includes('text/event-stream')) {
          const json = await toJsonFromSSE(resp, models);
          if (json) {
            return new Response(JSON.stringify(json), {
              status: 200,
              headers: { 'Content-Type':'application/json; charset=utf-8', 'Cache-Control':'no-store' }
            });
          }
        }
        return resp;
      };
    })();
  </script>

  <!-- Global alias -->
  <script>
    window.sendMessage = function(){
      if (window.PauleMain && typeof window.PauleMain.sendMessage === 'function'){
        return window.PauleMain.sendMessage();
      }
    };
  </script>

  <!-- Clerk JS (publishable key) -->
  <script async crossorigin="anonymous"
    data-clerk-publishable-key="pk_live_Y2xlcmsucGF1bGUuYWkk"
    src="https://cdn.jsdelivr.net/npm/@clerk/clerk-js@latest/dist/clerk.browser.js">
  </script>

  <noscript>
    <style>.nojs{position:fixed;inset:auto 0 0 0;background:#111827;color:#fff;padding:12px 16px;text-align:center;font:14px/1.4 system-ui}</style>
    <div class="nojs">Norint naudotis prisijungimu reikia ƒØjungti JavaScript.</div>
  </noscript>
</head>
<body>

  <!-- ======== MODAL ROOT (2 tipai) ======== -->
  <div id="modal" class="modal-overlay" aria-hidden="true">
    <button class="modal-close" type="button" aria-label="U≈ædaryti (Esc)">‚úï</button>
    <div class="modal-window modal--sheet" role="dialog" aria-modal="true" hidden>
      <div class="modal-sheet-inner" id="modalSheet"></div>
    </div>
    <div class="modal-window modal--tool" role="dialog" aria-modal="true" hidden>
      <div class="modal-body" id="modalTool"></div>
    </div>
  </div>

  <!-- ===== TOPBAR ===== -->
  <header class="topbar" data-no-clip="true" id="topbar" role="banner">
    <a class="brand" href="/" aria-label="Paule">
      <img id="brandLogo" class="brand-icon" src="/assets/icon/paule-logo.webp" alt="Paule logotipas">
    </a>

    <nav class="models-in-topbar" aria-label="Modeliai" id="modelList">
      <button class="model-pill active" data-model="paule" aria-pressed="true" type="button">
        <img class="ui-icon" src="/assets/icon/paule-logo.webp" alt=""> Paule
      </button>
      <button class="model-pill" data-model="chatgpt" type="button"><img class="ui-icon" src="/assets/icon/chatgpt.svg" alt=""> ChatGPT</button>
      <button class="model-pill" data-model="claude" type="button"><img class="ui-icon" src="/assets/icon/claude-seeklogo.svg" alt=""> Claude</button>
      <button class="model-pill" data-model="gemini" type="button"><img class="ui-icon" src="/assets/icon/gemini.svg" alt=""> Gemini</button>
      <button class="model-pill" data-model="grok" type="button"><img class="ui-icon" src="/assets/icon/xAI.svg" alt=""> Grok</button>
      <button class="model-pill" data-model="deepseek" type="button"><img class="ui-icon" src="/assets/icon/deepseek.svg" alt=""> DeepSeek</button>
      <button class="model-pill" data-model="llama" type="button"><img class="ui-icon" src="/assets/icon/llama.svg" alt=""> Llama</button>
    </nav>

    <div class="top-actions" id="topActions" role="navigation" aria-label="Pagrindiniai veiksmai">
      <a class="btn ghost" data-nav="pricing" href="#pricing" role="button">
        <img class="ui-icon" src="/assets/icon/nav-results.svg" alt=""> Planai
      </a>
      <a class="btn ghost" data-nav="community" href="/community" role="button">
        <img class="ui-icon" src="/assets/icon/nav-results.svg" alt=""> Bendruomenƒó
      </a>
      <button class="btn ghost" id="btnNewChat" type="button">
        <img class="ui-icon" src="/assets/icon/nav-new-chat.svg" alt=""> Naujas pokalbis
      </button>
      <button class="btn ghost" id="btnTheme" type="button" aria-label="Perjungti temƒÖ">
        <img class="ui-icon" src="/assets/icon/nav-theme.svg" alt=""> Tema
      </button>

      <div id="clerk-auth" class="login-anchor">
        <button class="btn ghost" id="loginFallback" type="button"
          onclick="window.openAuth ? openAuth() : (window.Clerk&&window.Clerk.openSignIn?window.Clerk.openSignIn({afterSignInUrl:'/',afterSignUpUrl:'/' }):alert('Kraunama‚Ä¶'));">
          <img class="ui-icon google" src="/assets/icon/google.svg" alt=""> Prisijungti
        </button>
      </div>

      <button class="btn ghost mobile-toggle" id="btnMobile" aria-label="Meniu (mobilus)" type="button">
        <img class="ui-icon" src="/assets/icon/nav-menu.svg" alt=""> Meniu
      </button>
    </div>
  </header>

  <div id="drawerOverlay" class="drawer-overlay" aria-hidden="true"></div>

  <div class="layout" id="layoutRoot">
    <aside class="sidebar" id="sidebar" role="complementary" aria-label="≈†oninƒó navigacija">
      <section class="side-section collapsible" id="specSection">
        <div class="side-title">
          <span>AI specialistai</span>
          <span class="car">‚ñæ</span>
        </div>
        <div class="specialist-grid" id="specialistGrid">
          <a class="chip" href="/spec/sefas.html" data-modal="tool"><img class="ui-icon" src="/assets/icon/chef-knife.svg" alt=""> ≈†efas</a>
          <a class="chip" href="/spec/marketing.html" data-modal="tool"><img class="ui-icon" src="/assets/icon/marketing-megaphone.svg" alt=""> Marketing</a>
          <a class="chip" href="/spec/pardavimai.html" data-modal="tool"><img class="ui-icon" src="/assets/icon/sales-handshake.svg" alt=""> Pardavimai</a>
          <a class="chip" href="/spec/verslas.html" data-modal="tool"><img class="ui-icon" src="/assets/icon/business-strategy.svg" alt=""> Verslas</a>
          <a class="chip" href="/spec/finansai.html" data-modal="tool"><img class="ui-icon" src="/assets/icon/finance-investment.svg" alt=""> Finansai</a>
          <a class="chip" href="/spec/keliones.html" data-modal="tool"><img class="ui-icon" src="/assets/icon/travel-map.svg" alt=""> Kelionƒós</a>
          <a class="chip" href="/spec/renginiai.html" data-modal="tool"><img class="ui-icon" src="/assets/icon/event-planning.svg" alt=""> Renginiai</a>
          <a class="chip" href="/spec/tikslai.html" data-modal="tool"><img class="ui-icon" src="/assets/icon/tool-mindmap.svg" alt=""> Tiksl≈≥ ≈æemƒólapis</a>
          <a class="chip" href="/spec/teisininkas.html" data-modal="tool"><img class="ui-icon" src="/assets/icon/legal-contract.svg" alt=""> Teisininkas</a>
          <a class="chip" href="/spec/psichologas.html" data-modal="tool"><img class="ui-icon" src="/assets/icon/psychology-brain.svg" alt=""> Psichologas</a>
          <a class="chip" href="/spec/sportas.html" data-modal="tool"><img class="ui-icon" src="/assets/icon/run.svg" alt=""> Sportas</a>
          <a class="chip" href="/spec/programuotojas.html" data-modal="tool"><img class="ui-icon" src="/assets/icon/code.svg" alt=""> Programuotojas</a>
        </div>
      </section>

      <section class="side-section">
        <div class="side-title">Aktyvumas</div>
        <div class="community-pings" id="communityPings" aria-live="polite">
          <div class="ping"><img class="ui-icon" src="/assets/icon/music.svg" alt=""> @Mantas ƒØkƒólƒó dainƒÖ ‚ÄûVasaros vƒójas‚Äú</div>
          <div class="ping"><img class="ui-icon" src="/assets/icon/photo.svg" alt=""> @Ieva pridƒójo 3 nuotraukas</div>
          <div class="ping"><img class="ui-icon" src="/assets/icon/video-library.svg" alt=""> @Ruta publikavo ‚ÄûReklama-15s‚Äú</div>
        </div>
      </section>

      <section class="side-section">
        <div class="side-title"><a class="lib-link" href="/biblioteka#dainos">Dainos</a></div>
        <div class="library-grid thumbs" id="songsFeed">
          <a class="lib-card thumb"><img src="/assets/hero/music.webp" alt=""><span>‚ÄûVasaros vƒójas‚Äú</span></a>
          <a class="lib-card thumb"><img src="/assets/hero/music.webp" alt=""><span>‚ÄûNakties ≈°viesos‚Äú</span></a>
          <a class="lib-card thumb"><img src="/assets/hero/music.webp" alt=""><span>‚ÄûMiesto pulsas‚Äú</span></a>
        </div>
      </section>

      <section class="side-section">
        <div class="side-title"><a class="lib-link" href="/biblioteka#nuotraukos">Nuotraukos</a></div>
        <div class="library-grid thumbs" id="photosFeed">
          <a class="lib-card thumb"><img src="/assets/hero/photo.webp" alt=""><span>Produktas</span></a>
          <a class="lib-card thumb"><img src="/assets/hero/photo.webp" alt=""><span>Kampanija</span></a>
          <a class="lib-card thumb"><img src="/assets/hero/photo.webp" alt=""><span>Vir≈°elis</span></a>
        </div>
      </section>

      <section class="side-section">
        <div class="side-title"><a class="lib-link" href="/biblioteka#video">Video</a></div>
        <div class="library-grid thumbs" id="videosFeed">
          <a class="lib-card thumb"><img src="/assets/hero/video.webp" alt=""><span>Reklama 15s</span></a>
          <a class="lib-card thumb"><img src="/assets/hero/video.webp" alt=""><span>Pristatymas</span></a>
          <a class="lib-card thumb"><img src="/assets/hero/video.webp" alt=""><span>U≈ækulisiai</span></a>
        </div>
      </section>

      <section class="side-section">
        <div class="side-title">Projektai</div>
        <div class="control-group" id="projectsList">
          <div class="project-item" data-project="new" role="button" tabindex="0">
            <img class="ui-icon" src="/assets/icon/plus.svg" alt=""> Naujas projektas
          </div>
        </div>
      </section>

      <section class="side-section">
        <div class="side-title">Pokalbi≈≥ istorija</div>
        <div class="control-group" id="historyList"></div>
      </section>
    </aside>

    <main class="main" role="main">
      <div class="chat-area" id="chatArea">
        <!-- HERO (6 kortelƒós) -->
        <section class="welcome" id="welcome" aria-label="Pradinis ekranas">
          <h1 class="hero-title">KAIP GALIU PADƒñTI ≈†IANDIEN?</h1>
          <p>Pasirink vir≈°uje modelius ir para≈°yk u≈æklausƒÖ. Visi modeliai atsakys paraleliai. üëá</p>

          <div class="welcome-grid">
            <a class="welcome-card" href="#" data-action="song">
              <img src="/assets/hero/music.webp" alt="">
              <b>Sukurti dainƒÖ</b><span>Pasveikink draugƒÖ unikalia gimtadienio daina.</span>
            </a>
            <a class="welcome-card" href="#" data-action="song-photo">
              <img src="/assets/hero/song-photo.webp" alt="">
              <b>Daina i≈° nuotraukos</b><span>ƒÆkelk kadrƒÖ ir gauk originaliƒÖ melodijƒÖ su ≈æod≈æiais.</span>
            </a>
            <a class="welcome-card" href="#" data-action="photo">
              <img src="/assets/hero/photo.webp" alt="">
              <b>Sukurti nuotraukƒÖ</b><span>Produktai, scenos, peiza≈æai, selfiai ir animacija.</span>
            </a>
            <a class="welcome-card" href="#" data-action="mindmap">
              <img src="/assets/hero/mindmap.webp" alt="">
              <b>Minƒçi≈≥ ≈æemƒólapis</b><span>Susitelk ƒØ esmƒô ir didink produktyvumƒÖ.</span>
            </a>
            <a class="welcome-card" href="/spec/tikslai.html" data-modal="tool">
              <img src="/assets/hero/goals.webp" alt="">
              <b>Tiksl≈≥ sistema (AI)</b><span>Vizija ‚Üí u≈æduotys ‚Üí real≈´s rezultatai.</span>
            </a>
            <a class="welcome-card" href="#" data-action="video">
              <img src="/assets/hero/video.webp" alt="">
              <b>Sukurti video</b><span>Reels ir Stories i≈° teksto ar nuotrauk≈≥.</span>
            </a>
          </div>
        </section>

        <!-- Paslƒópta Plan≈≥ sekcija (naudosim ƒØ modalƒÖ) -->
        <section id="pricing" class="pricing-section" aria-label="Planai" hidden>
          <h2 class="section-title">Planai</h2>
          <p class="section-sub">Pasirink sau tinkamiausiƒÖ planƒÖ. Galima at≈°aukti bet kada.</p>
          <stripe-pricing-table
            pricing-table-id="prctbl_1S5mCdGfWPiTH9M4MOXoL4f3"
            publishable-key="pk_test_51S5jh4GfWPiTH9M4gRYoHhV9LiZBjn7FPavf9nXPFIvbBLjQ89oyMRvKu0FRIhqx8boX4IHvtvRbQUdUWnvJwmaf00NszDYZC7">
          </stripe-pricing-table>
          <noscript>Norint matyti kainas, ƒØjunkite JavaScript.</noscript>
        </section>
      </div>
    </main>
  </div>

  <!-- ===== BOTTOM INPUT ===== -->
  <div class="bottom-section after-message" id="bottomSection" data-responsive="true">
    <div class="follow-suggest-bar" id="followSuggestBar" aria-live="polite"></div>

    <div class="input-bar" id="inputBar">
      <div class="input-container" id="inputContainer">
        <label for="messageInput" class="sr-only">Para≈°yk ƒçia‚Ä¶</label>
        <textarea class="message-input" id="messageInput" rows="1" placeholder="" autocomplete="on" autocapitalize="sentences" autocorrect="on" spellcheck="true"></textarea>
        <button class="send-btn" id="sendBtn" aria-label="Si≈≥sti" type="button">
          <img class="ui-icon" src="/assets/icon/arrow-top.svg" alt="">
        </button>
        <div class="input-suggest-deck" id="inputSuggestDeck" aria-live="polite"></div>
      </div>
    </div>

    <div class="tools-bar" id="toolsBar" role="toolbar" aria-label="ƒÆrankiai">
      <div class="tool" data-tool="mindmap" tabindex="0" role="button"><img class="ui-icon" src="/assets/icon/tool-mindmap.svg" alt=""> Mindmap</div>
      <div class="tool" data-tool="photo" tabindex="0" role="button"><img class="ui-icon" src="/assets/icon/tool-photo.svg" alt=""> Foto</div>
      <div class="tool" data-tool="file" tabindex="0" role="button"><img class="ui-icon" src="/assets/icon/tool-file.svg" alt=""> Failas</div>
      <div class="tool" data-tool="song" tabindex="0" role="button"><img class="ui-icon" src="/assets/icon/tool-music.svg" alt=""> Sukurti dainƒÖ</div>
      <div class="tool" data-tool="video" tabindex="0" role="button"><img class="ui-icon" src="/assets/icon/video-plus.svg" alt=""> Sukurti video</div>
      <div class="tool" data-tool="goals" tabindex="0" role="button"><img class="ui-icon" src="/assets/icon/tool-mindmap.svg" alt=""> Tiksl≈≥ sistema</div>
    </div>
  </div>

  <!-- ===== Orchestrator JS ===== -->
  <script>
  (function(){
    'use strict';

    const root=document.documentElement;
    const sidebar=document.getElementById('sidebar');
    const overlay=document.getElementById('drawerOverlay');
    const btnMobile=document.getElementById('btnMobile');
    const msgInput=document.getElementById('messageInput');
    const sendBtn=document.getElementById('sendBtn');
    const btnTheme=document.getElementById('btnTheme');
    const logo=document.getElementById('brandLogo');
    const modelList=document.getElementById('modelList');
    const chatArea  = document.getElementById('chatArea');
    const modal = document.getElementById('modal');
    const modalClose = modal.querySelector('.modal-close');
    const modalSheet = modal.querySelector('.modal--sheet');
    const modalTool  = modal.querySelector('.modal--tool');
    const modalSheetBody = document.getElementById('modalSheet');
    const modalToolBody  = document.getElementById('modalTool');

    const API_BASE   = (window.PAULE_CONFIG&&window.PAULE_CONFIG.restBase)  || '/api';
    const SSE_URL    = (window.PAULE_CONFIG&&window.PAULE_CONFIG.restStream)|| '/api/stream';
    const COMPLETE_URL = API_BASE + '/complete';
    const ICONS_BASE = (window.PAULE_CONFIG && window.PAULE_CONFIG.iconsBase) || '/assets/icon';

    const FRONT_TO_BACK={
      paule:'meta-llama/Llama-4-Scout-17B-16E-Instruct',
      chatgpt:'gpt-4o-mini',
      claude:'claude-3.5-sonnet-latest',   // ‚úÖ atnaujinta
      gemini:'gemini-2.5-flash',
      grok:'grok-4',
      deepseek:'deepseek-chat',
      llama:'meta-llama/Llama-4-Scout-17B-16E-Instruct'
    };
    const NON_SSE_FRONT = new Set(['claude','gemini','grok']);
    const MODEL_ICON = {
      paule: '/assets/icon/paule-logo.webp',
      chatgpt:`${ICONS_BASE}/chatgpt.svg`,
      claude:`${ICONS_BASE}/claude-seeklogo.svg`,
      gemini:`${ICONS_BASE}/gemini.svg`,
      grok:`${ICONS_BASE}/xAI.svg`,
      deepseek:`${ICONS_BASE}/deepseek.svg`,
      llama:`${ICONS_BASE}/llama.svg`
    };

    const state = {
      chatId:null, panels:{}, startedOrder:[], firstStarted:null,
      pending:0, errors:[], hasAnyText:false, stickToBottom:true, lastUserText:''
    };

    /* Tema */
    initTheme();
    function initTheme(){
      try{
        const saved = localStorage.getItem('paule_theme');
        if(saved==='dark'||saved==='light'){ root.setAttribute('data-theme', saved); }
      }catch(_){}
      setLogoByTheme();
      btnTheme?.addEventListener('click', ()=>{
        const cur = root.getAttribute('data-theme')==='dark'?'dark':'light';
        const next = cur==='dark'?'light':'dark';
        root.setAttribute('data-theme', next);
        try{ localStorage.setItem('paule_theme', next); }catch(_){}
        setLogoByTheme();
      });
    }
    function setLogoByTheme(){
      const dark = root.getAttribute('data-theme') === 'dark';
      logo.src = dark ? '/assets/icon/paule-logo-dark.webp' : '/assets/icon/paule-logo.webp';
      logo.setAttribute('alt', dark ? 'Paule logotipas ‚Äì tamsi tema' : 'Paule logotipas ‚Äì ≈°viesi tema');
    }

    /* Drawer */
    btnMobile?.addEventListener('click', ()=>{ sidebar.classList.add('open'); overlay.classList.add('show'); });
    overlay?.addEventListener('click', ()=>{ sidebar.classList.remove('open'); overlay.classList.remove('show'); });

    /* Collapsible ‚ÄûAI specialistai‚Äú */
    (function(){
      const sec=document.getElementById('specSection');
      const ttl=sec?.querySelector('.side-title');
      ttl?.addEventListener('click', ()=>{ sec.classList.toggle('collapsed'); });
    })();

    /* Modal valdymas */
    function openModal(type, htmlOrEl){
      modal.classList.add('show');
      modal.setAttribute('aria-hidden','false');
      document.body.style.overflow='hidden';
      modalSheet.hidden=true; modalTool.hidden=true;
      if(type==='sheet'){
        modalSheet.hidden=false;
        modalSheetBody.innerHTML='';
        if(typeof htmlOrEl==='string') modalSheetBody.innerHTML=htmlOrEl; else if(htmlOrEl) modalSheetBody.appendChild(htmlOrEl);
      }else{
        modalTool.hidden=false;
        modalToolBody.innerHTML='';
        if(typeof htmlOrEl==='string') modalToolBody.innerHTML=htmlOrEl; else if(htmlOrEl) modalToolBody.appendChild(htmlOrEl);
      }
    }
    function closeModal(){
      modal.classList.remove('show');
      modal.setAttribute('aria-hidden','true');
      document.body.style.overflow='';
      modalSheetBody.innerHTML=''; modalToolBody.innerHTML='';
    }
    modalClose.addEventListener('click', closeModal);
    modal.addEventListener('click', (e)=>{ if(e.target===modal) closeModal(); });
    window.addEventListener('keydown', (e)=>{ if(e.key==='Escape' && modal.classList.contains('show')) closeModal(); });

    (function(){
      const link=document.querySelector('a[data-nav="pricing"][href="#pricing"]');
      const source=document.getElementById('pricing');
      link?.addEventListener('click', (e)=>{
        e.preventDefault();
        if(!source) return;
        const clone = source.cloneNode(true);
        clone.hidden=false;
        openModal('sheet', clone);
      });
    })();

    document.getElementById('specialistGrid')?.addEventListener('click', async (e)=>{
      const a=e.target.closest('a[data-modal="tool"]'); if(!a) return;
      e.preventDefault();
      try{
        const res = await fetch(a.getAttribute('href'), {cache:'no-store'}); 
        const html = await res.text();
        openModal('tool', html);
      }catch(err){
        openModal('tool', `<div style="padding:24px">Nepavyko ƒØkelti. Bandykite dar kartƒÖ.</div>`);
      }
    });

    function hijackSheet(selector){
      document.querySelectorAll(selector).forEach(a=>{
        a.addEventListener('click', async (e)=>{
          const href=a.getAttribute('href')||'';
          if(!/^https?:/i.test(href)){
            e.preventDefault();
            try{ const r=await fetch(href,{cache:'no-store'}); const t=await r.text(); openModal('sheet', t); }
            catch(_){ location.href=href; }
          }
        });
      });
    }
    hijackSheet('a.footer-link, a[data-sheet]');

    /* Scroll lock + ‚ÄûƒÆ naujausiƒÖ‚Äú */
    let jumpBtn;
    attachScroll();
    function attachScroll(){
      if (!chatArea) return;
      if (!jumpBtn){
        jumpBtn = document.createElement('button');
        jumpBtn.className='jump-latest';
        jumpBtn.style.position='fixed';
        jumpBtn.style.right='16px';
        jumpBtn.style.bottom='2cm';
        jumpBtn.innerHTML = `<img class="ui-icon" src="/assets/icon/arrow-down.svg" alt="ƒÆ naujausiƒÖ">`;
        jumpBtn.title = 'ƒÆ naujausiƒÖ';
        jumpBtn.addEventListener('click', ()=>{ chatArea.scrollTo({top:chatArea.scrollHeight, behavior:'smooth'}); jumpBtn.classList.remove('show'); state.stickToBottom=true; });
        document.body.appendChild(jumpBtn);
      }
      chatArea.addEventListener('scroll', ()=>{
        const nearBottom = chatArea.scrollTop + chatArea.clientHeight >= chatArea.scrollHeight - 80;
        state.stickToBottom = !!nearBottom;
        jumpBtn.classList.toggle('show', !nearBottom);
      }, {passive:true});
    }
    function autoscrollIfNeeded(){}

    function timeNow(){ return new Date().toLocaleTimeString('lt-LT',{hour:'2-digit',minute:'2-digit'}); }
    function escapeHtml(x){ const d=document.createElement('div'); d.textContent=(x==null?'':String(x)); return d.innerHTML; }

    /* ========== CHAT UI (stream + json) ========== */
    function ensurePanel(front){
      if (state.panels[front]) return state.panels[front];
      const icon = MODEL_ICON[front] || '/assets/icon/ai.svg';
      const name = front.charAt(0).toUpperCase()+front.slice(1);
      const n = document.createElement('div'); n.className='message';
      n.innerHTML = `
        <div class="avatar"><img class="ui-icon" src="${icon}" alt=""></div>
        <div class="bubble" data-model="${front}">
          <div class="bubble-card">
            <div style="position:absolute;right:8px;top:8px;display:flex;gap:6px">
              <button class="copy-btn" title="Kopijuoti" type="button"
                onclick="(function(b){const t=b.closest('.bubble-card')?.querySelector('.msg-content')?.innerText||'';navigator.clipboard.writeText(t).catch(()=>{});b.classList.add('ok');setTimeout(()=>b.classList.remove('ok'),900)})(this)"
                style="font-size:12px;border:1px solid var(--border);background:var(--bg-primary);padding:4px 6px;border-radius:6px;cursor:pointer;opacity:.8">‚ßâ</button>
              <button class="expand-btn" title="I≈°plƒósti" type="button"
                onclick="(function(b){const bub=b.closest('.bubble');bub.classList.toggle('fullscreen');})(this)"
                style="font-size:12px;border:1px solid var(--border);background:var(--bg-primary);padding:4px 6px;border-radius:6px;cursor:pointer;opacity:.8">‚ÜóÔ∏é</button>
            </div>
            <div class="msg-content"><span class="typing-dots"><i></i><i></i><i></i></span></div>
            <div class="msg-meta"><span class="model-tag">${name}</span><span>${timeNow()}</span></div>
          </div>
        </div>`;
      n.style.opacity='0'; n.style.transform='translateY(16px)';
      chatArea.appendChild(n);
      requestAnimationFrame(()=>{ n.style.transition='all .25s ease'; n.style.opacity='1'; n.style.transform='translateY(0)'; });
      const contentEl = n.querySelector('.msg-content');
      const panel = { el: contentEl, wrap:n, bubble:n.querySelector('.bubble'), content:'', done:false };
      state.panels[front]=panel;
      state.startedOrder.push(front);
      return panel;
    }

    function preparePanels(fronts){
      (fronts||[]).forEach(f=>{
        if (!state.panels[f]) {
          const p = ensurePanel(f);
          if (p && p.el) p.el.innerHTML = `<span class="typing-dots"><i></i><i></i><i></i></span>`;
        }
      });
    }

    // üßπ Nebebus globalaus ‚ÄûAI mƒÖsto‚Äú overlay ‚Äì jokio bloko srautui
    function showGlobalWait(){ /* no-op */ }
    function hideGlobalWait(){ /* no-op */ }

    function resetRound(){
      state.chatId = 'chat_'+Date.now().toString(36)+'_'+Math.random().toString(36).slice(2,8);
      state.panels={}; state.startedOrder=[]; state.firstStarted=null;
      state.pending=0; state.errors=[]; state.hasAnyText=false;
      showGlobalWait(); // no-op
    }

    async function startOrchestrator(text, fronts){
      const streamFronts = fronts.filter(f=> !NON_SSE_FRONT.has(f));
      const jsonFronts   = fronts.filter(f=>  NON_SSE_FRONT.has(f));

      preparePanels([...streamFronts, ...jsonFronts]);

      state.pending = streamFronts.length + jsonFronts.length;

      streamFronts.forEach(f=>{
        const back = FRONT_TO_BACK[f]||f;
        runSSE({ front:f, back, text, chatId:state.chatId }).catch(()=>{}).finally(()=>decPending());
      });

      if (jsonFronts.length){
        runJSONOnce({ fronts: jsonFronts, text, chatId: state.chatId }).catch(()=>{});
      }
      setTimeout(()=>{ if (state.pending>0){ state.pending=0; finalizeRound(); } }, 22000);
    }

    function decPending(){ state.pending = Math.max(0, state.pending-1); if (state.pending===0) finalizeRound(); }
    function finalizeRound(){
      hideGlobalWait(); // no-op
      if (state.errors.length){
        const wrap = document.createElement('div');
        state.errors.forEach(er=>{
          const n = document.createElement('div'); n.className='message';
          n.innerHTML = `<div class="avatar"><img class="ui-icon" src="${MODEL_ICON[er.front]||'/assets/icon/ai.svg'}" alt=""></div>
            <div class="bubble"><div class="bubble-card error-card">
              <div class="msg-content"><strong>${escapeHtml(er.name||er.front||'Modelis')}</strong> ‚Äì atsakymo nepavyko gauti.<br><span class="dim">${escapeHtml(er.msg||'Klaida')}</span></div>
              <div class="msg-meta"><span>${escapeHtml(er.name||er.front||'Modelis')}</span><span>${timeNow()}</span></div>
            </div></div>`;
          wrap.appendChild(n);
        });
        chatArea.appendChild(wrap);
      }
    }

    function parseErrEvent(e){
      try{ const data = (e&&e.data)? JSON.parse(e.data):{}; return data?.message || 'Klaida'; }
      catch(_){ return 'Klaida'; }
    }

    async function runSSE({ front, back, text, chatId }){
      try{
        const qs=new URLSearchParams({ model: back, models: back, message:text, max_tokens:'4096', chat_id:chatId, _t:Date.now().toString() });
        const resp=await fetch(`${SSE_URL}?${qs}`, { headers:{ 'Accept':'text/event-stream' }, cache:'no-store', credentials:'same-origin' });
        const ct=(resp.headers.get('content-type')||'').toLowerCase();

        if(!ct.includes('text/event-stream')){
          try{
            const j=await resp.json();
            const txt=j?.answers?.[0]?.text||j?.text||'';
            if (txt){
              const p = ensurePanel(front);
              p.content += txt; p.el.innerHTML = p.content;
            } else { state.errors.push({front, name:front, msg:'Tu≈°ƒçias atsakymas (JSON).'}); }
          }catch(_){ state.errors.push({front, name:front, msg:'Neskaidomas atsakymas (JSON).'}); }
          return;
        }

        const reader=resp.body.getReader();
        const dec=new TextDecoder();
        let buf='';
        for(;;){
          const {done,value}=await reader.read(); if(done) break;
          buf+=dec.decode(value,{stream:true});
          let i; while((i=buf.indexOf('\n\n'))>=0){
            const frame=buf.slice(0,i).trim(); buf=buf.slice(i+2);
            if(!frame) continue;
            const dataLine = frame.split('\n').find(l=> l.startsWith('data:'));
            const eventLine = frame.split('\n').find(l=> l.startsWith('event:'));
            const ev = eventLine ? eventLine.replace(/^event:\s*/,'').trim() : 'message';
            if(!dataLine) continue;
            const data = dataLine.replace(/^data:\s*/,'').trim();
            if (data==='[DONE]'){ buf=''; break; }
            if (ev==='error'){
              state.errors.push({front, name:front, msg: parseErrEvent({data})});
              continue;
            }
            let piece='';
            try{
              const j=JSON.parse(data);
              piece = j?.choices?.[0]?.delta?.content ?? j?.text ?? j?.data ?? '';
            }catch{ piece = data; }
            if(piece){
              const p = ensurePanel(front);
              p.content += piece; p.el.innerHTML = p.content;
            }
          }
        }
        const p = state.panels[front]; if (p) p.done=true;
      }catch(_){ state.errors.push({front, name:front, msg:'SSE nepavyko inicijuoti.'}); }
    }

    async function runJSONOnce({ fronts, text, chatId }){
      const backIds = fronts.map(f=> FRONT_TO_BACK[f]||f).join(',');
      try{
        const res = await fetch(COMPLETE_URL, { method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify({ message:text, models:backIds, chat_id:chatId, max_tokens:4096 })});
        if (!res.ok) throw new Error('HTTP '+res.status);
        const j = await res.json();
        const answers = Array.isArray(j?.answers)? j.answers : [];
        const gotFronts = new Set();
        for (const ans of answers){
          const back = ans.model||'';
          const front = fronts.find(f=> (FRONT_TO_BACK[f]||f)===back) || fronts[0];
          gotFronts.add(front);
          const txt = ans.text||'';
          if (txt){
            const p = ensurePanel(front);
            p.content += txt; p.el.innerHTML = p.content; p.done=true;
          } else {
            const emsg = ans.error ? String(ans.error) : 'Tu≈°ƒçias atsakymas (JSON).';
            state.errors.push({ front, name:front, msg: emsg });
          }
          decPending();
        }
        fronts.forEach(f=>{ if(!gotFronts.has(f)){ state.errors.push({ front:f, name:f, msg:'Nepavyko gauti atsakymo (JSON).' }); decPending(); } });
      }catch(e){
        fronts.forEach(f=> { state.errors.push({ front:f, name:f, msg:'Nepavyko gauti atsakymo (JSON).' }); decPending(); });
      }
    }

    function doSend(){
      const text=(msgInput.value||'').trim(); if(!text) return;
      state.lastUserText = text;
      msgInput.value='';
      addUserBubble(text);

      let fronts=[...modelList.querySelectorAll('.model-pill.active')].map(b=>b.dataset.model).filter(Boolean);
      if(!fronts.length) fronts=['paule','chatgpt','deepseek'];

      resetRound();
      startOrchestrator(text, fronts);
    }

    msgInput.addEventListener('keydown', (e)=>{ if(e.key==='Enter' && !e.shiftKey){ e.preventDefault(); doSend(); }});
    sendBtn.addEventListener('click', (e)=>{ e.preventDefault(); doSend(); });
    sendBtn.addEventListener('touchstart', (e)=>{ e.preventDefault(); doSend(); }, {passive:false});

    modelList.addEventListener('click', (e)=>{
      const b=e.target.closest('.model-pill'); if(!b) return;
      b.classList.toggle('active');
      b.setAttribute('aria-pressed', b.classList.contains('active')?'true':'false');
    });

    window.PauleMain = { sendMessage: doSend };
    window.PauleModal = { open: openModal, close: closeModal };
  })();
  </script>

  <!-- ===== Google-first AUTH modal (sheet) ===== -->
  <script>
    (function(){
      const AUTH_KEY = 'auth_dismissed_v2';

      function authHtml(){
        return `
          <div style="max-width:520px;margin:0 auto;padding:24px">
            <h3 style="margin:0 0 6px;font-weight:800">Prisijungti</h3>
            <p class="dim" style="margin:0 0 18px">Greitai, paprastai ir saugiai.</p>

            <button id="authGoogle" type="button"
              style="width:100%;height:46px;border-radius:12px;display:flex;align-items:center;justify-content:center;gap:10px;border:1px solid var(--border,#e5e7eb);background:#fff;cursor:pointer;font-weight:600">
              <img class="ui-icon" src="/assets/icon/google.svg" alt="" style="width:18px;height:18px"> Prisijungti su Google
            </button>

            <div class="dim" style="text-align:center;margin:14px 0">arba</div>

            <div style="display:flex;gap:8px;justify-content:center">
              <button id="authEmailIn" class="btn ghost"  type="button">Prisijungti el. pa≈°tu</button>
              <button id="authEmailUp" class="btn ghost"  type="button">Registruotis</button>
            </div>

            <div class="dim" style="margin-top:16px;font-size:12px">
              Tƒôsdami sutinkate su m≈´s≈≥ <a href="/legal/privacy.html" class="footer-link" data-sheet>privatumo politika</a>.
            </div>
          </div>`;
      }

      async function loadClerk(){
        const c = window.Clerk;
        if (!c || !c.load) return null;
        try { await c.load(); return c; } catch(_) { return null; }
      }

      window.openAuth = async function(){
        if (!window.PauleModal) return alert('Kraunama‚Ä¶');
        window.PauleModal.open('sheet', authHtml());

        const host = document.getElementById('modalSheet');
        const btnG = host.querySelector('#authGoogle');
        const btnIn= host.querySelector('#authEmailIn');
        const btnUp= host.querySelector('#authEmailUp');

        btnG.onclick = async () => {
          const clerk = await loadClerk();
          if (clerk?.authenticateWithRedirect){
            clerk.authenticateWithRedirect({
              strategy: 'oauth_google',
              redirectUrl: '/',
              redirectUrlComplete: '/'
            });
          } else if (clerk?.openSignIn){
            clerk.openSignIn({ afterSignInUrl:'/', afterSignUpUrl:'/' });
          } else {
            alert('Kraunama‚Ä¶');
          }
        };

        btnIn.onclick = async () => (await loadClerk())?.openSignIn({ afterSignInUrl:'/', afterSignUpUrl:'/' });
        btnUp.onclick = async () => (await loadClerk())?.openSignUp({  afterSignUpUrl:'/' });

        const closeBtn = document.querySelector('#modal .modal-close');
        const onClose = () => { try{ sessionStorage.setItem(AUTH_KEY,'1'); }catch(_){ } };
        closeBtn?.addEventListener('click', onClose, { once:true });
      };
    })();
  </script>

  <!-- ===== Clerk UI montavimas (auto atidarymas po 3 s) ===== -->
  <script>
    (function(){
      const root = document.getElementById('clerk-auth');
      const SHOWN_KEY='auth_auto_shown_v2';

      function svgGoogle(){
        const s = document.createElementNS('http://www.w3.org/2000/svg', 'svg');
        s.setAttribute('viewBox','0 0 533.5 544.3');
        s.setAttribute('width','16'); s.setAttribute('height','16'); s.style.marginRight='6px';
        const p1=document.createElementNS(s.namespaceURI,'path'); p1.setAttribute('fill','#EA4335'); p1.setAttribute('d','M533.5 278.4c0-18.5-1.7-36.4-5-53.6H272v101.5h147.5c-6.4 34.5-25.9 63.7-55.2 83.2v69.1h89.2c52.2-48.1 80-119 80-200.2z');
        const p2=document.createElementNS(s.namespaceURI,'path'); p2.setAttribute('fill','#34A853'); p2.setAttribute('d','M272 544.3c74 0 136-24.5 181.4-66.5l-89.2-69.1c-24.8 16.6-56.5 26.5-92.3 26.5-70.9 0-131-47.8-152.5-112.1H27.3v70.4C72.3 486.1 165.4 544.3 272 544.3z');
        const p3=document.createElementNS(s.namespaceURI,'path'); p3.setAttribute('fill','#4A90E2'); p3.setAttribute('d','M119.5 322.9c-5.6-16.6-8.8-34.3-8.8-52.9s3.2-36.3 8.8-52.9V146.7H27.3C9.7 182.4 0 222.1 0 270s9.7 87.6 27.3 123.3l92.2-70.4z');
        const p4=document.createElementNS(s.namespaceURI,'path'); p4.setAttribute('fill','#FBBC05'); p4.setAttribute('d','M272 107.7c40.3 0 76.5 13.9 105 41.2l-78.7-78.7C408 25.2 346 0 272 0 165.4 0 72.3 58.2 27.3 146.7l92.2 70.4C141 155.8 201.1 107.7 272 107.7z');
        s.append(p1,p2,p3,p4); return s;
      }

      function button(classes, text, withGoogleIcon){
        const b = document.createElement('button');
        b.className = classes; b.type = 'button';
        if (withGoogleIcon) b.appendChild(svgGoogle());
        b.appendChild(document.createTextNode(text));
        return b;
      }

      function renderFallback(){
        if (!root) return;
        root.innerHTML = '';
        const inBtn = button('btn ghost', 'Prisijungti', true);
        inBtn.onclick = () => window.openAuth ? openAuth() : alert('Kraunama‚Ä¶');
        root.append(inBtn);
      }

      window.addEventListener('load', async () => {
        try{
          const clerk = window.Clerk;
          if (!clerk || !clerk.load) { renderFallback(); return; }

          await clerk.load();

          const rerender = () => {
            if (!root) return;
            root.innerHTML = '';
            if (clerk.user){
              const holder = document.createElement('div');
              root.appendChild(holder);
              clerk.mountUserButton(holder, { appearance: { elements: { userButtonAvatarBox: 'rounded-xl' } } });
            } else {
              const loginBtn  = button('btn ghost', 'Prisijungti', true);
              loginBtn.onclick = () => openAuth();
              root.append(loginBtn);

              if (!sessionStorage.getItem(SHOWN_KEY)){
                setTimeout(()=>{
                  if (!window.Clerk?.user && window.openAuth){
                    openAuth();
                    sessionStorage.setItem(SHOWN_KEY,'1');
                  }
                }, 3000);
              }
            }
          };

          rerender();
          clerk.addListener(rerender);
        }catch(_){ renderFallback(); }
      });
    })();
  </script>

  <!-- ===== Pora≈°tƒó ===== -->
  <footer class="site-footer left">
    <a class="footer-link" href="/legal/privacy.html" data-sheet>Privatumo politika</a>
    <span class="sep">‚Ä¢</span>
    <a class="footer-link" href="/legal/refunds.html" data-sheet>Pinig≈≥ grƒÖ≈æinimas</a>
    <span class="sep">‚Ä¢</span>
    <a class="footer-link" href="/legal/cookies.html" data-sheet>Slapuk≈≥ politika</a>
    <span class="sep">‚Ä¢</span>
    <a class="footer-link" href="/legal/ai-disclaimer.html" data-sheet>AI atsakomybƒós ribojimas</a>
    <span class="sep">‚Ä¢</span>
    <a class="footer-link" href="/legal/fair-use.html" data-sheet>SƒÖ≈æiningo naudojimo taisyklƒós</a>

    <div class="legal-note" style="margin-top:8px;font-size:12px;opacity:.75">
      <p>AI atsakymai generuojami automati≈°kai ir gali b≈´ti netiksl≈´s ‚Äì kritinƒô informacijƒÖ patikrinkite.</p>
      <p>Naudodami paslaugƒÖ sutinkate, kad turinys teikiamas ‚Äûkaip yra‚Äú, laikantis m≈´s≈≥ taisykli≈≥.</p>
    </div>
  </footer>

  <!-- ===== Cookie bar (Sutinku / Atsisakyti) ===== -->
  <div id="cookie-bar" role="dialog" aria-live="polite" aria-label="Slapuk≈≥ prane≈°imas" style="display:none">
    <div>Naudojame slapukus paslaugos veikimui ir tobulinimams. Daugiau ‚Äì
      <a href="/legal/cookies.html" class="footer-link" data-sheet>Slapuk≈≥ politikoje</a>.
    </div>
    <div class="actions">
      <button id="cookie-accept" type="button">Sutinku</button>
      <button id="cookie-decline" type="button">Atsisakyti</button>
    </div>
  </div>
  <script>
    (function(){
      const KEY='cookie_choice_v1';
      const bar=document.getElementById('cookie-bar');
      const ok = document.getElementById('cookie-accept');
      const no = document.getElementById('cookie-decline');
      try{
        const v=localStorage.getItem(KEY);
        if(!v) bar.style.display='block';
        ok?.addEventListener('click', ()=>{ localStorage.setItem(KEY,'allow'); bar.style.display='none'; });
        no?.addEventListener('click',  ()=>{ localStorage.setItem(KEY,'deny');  bar.style.display='none'; });
      }catch(_){}
    })();
  </script>

</body>
</html>


