<!doctype html>
<html lang="lt">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Paule Admin</title>
  <style>
    body{font-family:system-ui,-apple-system,Segoe UI,Roboto,sans-serif;padding:24px;max-width:780px;margin:auto}
    .grid{display:grid;grid-template-columns:1fr 1fr;gap:12px}
    input,button,select{padding:10px;border:1px solid #ddd;border-radius:10px}
    .card{border:1px solid #eee;border-radius:14px;padding:16px;margin:12px 0}
    .ok{color:#047857}.no{color:#b91c1c}
    .muted{opacity:.7;font-size:12px}
    .row{display:flex;gap:8px;align-items:center}
    .row > *{flex:1}
    .warn{background:#fff7ed;border:1px solid #fed7aa;padding:10px;border-radius:10px}
  </style>
</head>
<body>
  <h1>Paule – Admin</h1>

  <div class="card">
    <div class="warn">Raktus <b>produkcijai</b> saugiausia įrašyti per <b>Vercel → Project → Settings → Environment Variables</b>.
      Šis puslapis gali įrašyti per Vercel API tik jei nustatyti <code>VERCEL_TOKEN</code>, <code>VERCEL_PROJECT_ID</code>, <code>ADMIN_SECRET</code>.</div>
  </div>

  <div class="card">
    <h3>Būsena</h3>
    <pre id="diag" style="white-space:pre-wrap;background:#fafafa;border-radius:10px;padding:12px;border:1px solid #eee">…</pre>
    <button id="refresh">Atnaujinti</button>
  </div>

  <div class="card">
    <h3>Įrašyti / atnaujinti API raktą (pasirinktinai)</h3>
    <div class="grid">
      <select id="provider">
        <option value="openai">OPENAI_API_KEY</option>
        <option value="anthropic">ANTHROPIC_API_KEY</option>
        <option value="google">GOOGLE_API_KEY</option>
        <option value="xai">XAI_API_KEY</option>
        <option value="deepseek">DEEPSEEK_API_KEY</option>
        <option value="together">TOGETHER_API_KEY</option>
        <option value="runway">RUNWAY_API_KEY</option>
        <option value="suno">SUNO_API_KEY</option>
        <option value="flux">FLUX_API_KEY</option>
      </select>
      <input id="value" type="password" placeholder="Nauja reikšmė (API key)">
    </div>
    <div class="row" style="margin-top:8px">
      <input id="adminSecret" type="password" placeholder="ADMIN_SECRET">
      <select id="target">
        <option value="production">production</option>
        <option value="preview">preview</option>
        <option value="development">development</option>
      </select>
      <button id="save">Išsaugoti</button>
    </div>
    <div class="muted">Jei Vercel API nenaudojama (trūksta kintamųjų) – gausi „501 Not configured“.</div>
    <pre id="saveOut" class="muted">…</pre>
  </div>

<script>
async function refresh(){
  const r = await fetch('/api/paule/v1/diagnostics');
  const j = await r.json();
  diag.textContent = JSON.stringify(j, null, 2);
}
refresh();
refreshBtn = document.getElementById('refresh');
if (refreshBtn) refreshBtn.onclick = refresh;

document.getElementById('save').onclick = async () => {
  const provider = document.getElementById('provider').value;
  const value = document.getElementById('value').value;
  const adminSecret = document.getElementById('adminSecret').value;
  const target = document.getElementById('target').value;

  const r = await fetch('/api/paule/v1/admin/set', {
    method: 'POST',
    headers: {'Content-Type':'application/json'},
    body: JSON.stringify({ provider, value, target, adminSecret })
  });
  const j = await r.json();
  document.getElementById('saveOut').textContent = JSON.stringify(j, null, 2);
  if (j.ok) refresh();
};
</script>
</body>
</html>
