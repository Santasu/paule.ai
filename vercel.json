{
  "version": 2,

  "functions": {
    "api/**/*.js": { "runtime": "nodejs20.x", "maxDuration": 60 }
  },

  "builds": [
    { "src": "api/**/*.js", "use": "@vercel/node" },
    { "src": "public/**/*", "use": "@vercel/static" }
  ],

  "rewrites": [
    { "source": "/api/stream",              "destination": "/api/stream.js" },
    { "source": "/api/complete",            "destination": "/api/complete.js" },
    { "source": "/api/suggest",             "destination": "/api/suggest.js" },
    { "source": "/api/models",              "destination": "/api/models.js" },
    { "source": "/api/diagnostics",         "destination": "/api/diagnostics.js" },
    { "source": "/api/library/recent",      "destination": "/api/library/recent.js" },

    { "source": "/api/flux/create",         "destination": "/api/flux/create.js" },
    { "source": "/api/comic/create",        "destination": "/api/comic/create.js" },
    { "source": "/api/runway/image",        "destination": "/api/runway/image.js" },
    { "source": "/api/runway/status",       "destination": "/api/runway/status.js" },
    { "source": "/api/music/create",        "destination": "/api/music/create.js" },
    { "source": "/api/music/status",        "destination": "/api/music/status.js" },
    { "source": "/api/clerk/pk",            "destination": "/api/clerk/pk.js" },

    { "source": "/api/paule/v1/stream",       "destination": "/api/stream.js" },
    { "source": "/api/paule/v1/complete",     "destination": "/api/complete.js" },
    { "source": "/api/paule/v1/suggest",      "destination": "/api/suggest.js" },
    { "source": "/api/paule/v1/models",       "destination": "/api/models.js" },
    { "source": "/api/paule/v1/diagnostics",  "destination": "/api/diagnostics.js" },
    { "source": "/api/paule/v1/flux/create",  "destination": "/api/flux/create.js" },
    { "source": "/api/paule/v1/comic/create", "destination": "/api/comic/create.js" },
    { "source": "/api/paule/v1/runway/image", "destination": "/api/runway/image.js" },
    { "source": "/api/paule/v1/runway/status","destination": "/api/runway/status.js" },
    { "source": "/api/paule/v1/music/create", "destination": "/api/music/create.js" },
    { "source": "/api/paule/v1/music/status", "destination": "/api/music/status.js" },

    { "source": "/wp-json/paule/v1/stream",        "destination": "/api/stream.js" },
    { "source": "/wp-json/paule/v1/complete",      "destination": "/api/complete.js" },
    { "source": "/wp-json/paule/v1/suggest",       "destination": "/api/suggest.js" },
    { "source": "/wp-json/paule/v1/models",        "destination": "/api/models.js" },
    { "source": "/wp-json/paule/v1/diagnostics",   "destination": "/api/diagnostics.js" },
    { "source": "/wp-json/paule/v1/flux/create",   "destination": "/api/flux/create.js" },
    { "source": "/wp-json/paule/v1/comic/create",  "destination": "/api/comic/create.js" },
    { "source": "/wp-json/paule/v1/runway/image",  "destination": "/api/runway/image.js" },
    { "source": "/wp-json/paule/v1/runway/status", "destination": "/api/runway/status.js" },
    { "source": "/wp-json/paule/v1/music/create",  "destination": "/api/music/create.js" },
    { "source": "/wp-json/paule/v1/music/status",  "destination": "/api/music/status.js" },

    { "source": "/", "destination": "/index.html" },

    {
      "source": "/((?!api).*)",
      "destination": "/index.html",
      "missing": [{ "type": "file", "path": "/$1" }]
    }
  ],

  "headers": [
    { "source": "/index.html", "headers": [{ "key": "Cache-Control", "value": "no-store" }] },
    { "source": "/assets/(.*)", "headers": [{ "key": "Cache-Control", "value": "public, max-age=31536000, immutable" }] }
  ]
}

